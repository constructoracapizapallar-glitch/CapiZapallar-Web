<!DOCTYPE html>
<html lang="es" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Casas Prefabricadas | Capi Zapallar</title>
    <meta name="description"
        content="Cotiza tu Casa Prefabricada SIP. Modelos Tiny 18m2 y 35m2. Desde Kits de autoconstrucci√≥n hasta Llave en Mano.">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Plus+Jakarta+Sans:wght@700;800&family=JetBrains+Mono&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="styles.css?v=1.2">
    <style>
        /* CRITICAL RESCUE STYLES - Ensuring proper layout even if external CSS fails */
        .option-card {
            background: rgba(var(--glass-bg-rgb, 30, 30, 35), 0.5) !important;
            border: 1px solid var(--glass-border) !important;
            padding: 15px 20px !important;
            border-radius: 12px !important;
            margin-bottom: 15px !important;
            cursor: pointer !important;
            display: block !important;
        }

        .model-selector {
            display: flex !important;
            gap: 12px !important;
            margin-bottom: 30px !important;
            overflow-x: auto !important;
            padding: 10px 5px !important;
            scrollbar-width: thin;
            justify-content: flex-start !important;
        }

        .model-btn {
            white-space: nowrap !important;
            padding: 10px 25px !important;
            font-size: 0.9rem !important;
            min-width: auto !important;
            flex-shrink: 0 !important;
        }

        .product-image-wrapper {
            height: auto !important;
            max-height: 450px !important;
            overflow: hidden !important;
            border-radius: 20px !important;
            margin-bottom: 25px !important;
            background: #000 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        #model-image {
            width: 100% !important;
            height: auto !important;
            object-fit: contain !important;
        }

        .config-grid {
            display: grid !important;
            grid-template-columns: 1fr 380px !important;
            gap: 30px !important;
        }

        @media (max-width: 1024px) {
            .config-grid {
                grid-template-columns: 1fr !important;
            }
        }

        .option-card.selected {
            border-color: var(--primary-500) !important;
            background: rgba(var(--primary-rgb, 230, 194, 136), 0.1) !important;
        }

        @media (max-width: 900px) {
            .config-grid {
                grid-template-columns: 1fr !important;
            }
        }

        /* Form Fixes */
        .contact-wrapper {
            padding: 50px !important;
            border-radius: 30px !important;
        }

        .contact-form {
            gap: 15px !important;
        }

        .form-group label {
            font-size: 0.9rem !important;
            margin-bottom: 5px !important;
            display: block !important;
        }

        .section-title {
            font-size: 2.2rem !important;
            margin-bottom: 15px !important;
        }

        summary::-webkit-details-marker {
            display: none;
        }

        .config-section-title {
            font-size: 1.2rem;
            color: var(--primary-500);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 5px;
        }
    </style>
</head>

<body class="dark-mode">
    <div id="particles-js"></div>

    <nav class="navbar" id="navbar">
        <div class="container navbar-container">
            <a href="index.html" class="logo-container">
                <img src="images/logo.svg" alt="Capi Zapallar Logo" class="logo-img" style="height: 50px; width: auto;">
                <span class="logo-text">Capi Zapallar</span>
            </a>
            <div class="nav-links">
                <a href="index.html#hero" class="nav-link">Inicio</a>
                <a href="prefabricadas.html" class="nav-link" style="color: var(--primary-500);">Cotizador</a>
                <a href="#cotizador-anchor" class="btn btn-primary" style="padding: 8px 20px;">Cotizar Ahora</a>
                <button id="themeToggle" class="theme-toggle" aria-label="Cambiar Tema">
                    <span class="theme-icon">üåì</span>
                </button>
            </div>
            <button class="mobile-menu-toggle" id="menuToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Product Hero -->
    <header class="product-hero">
        <div class="container">
            <span class="label-upper">Sistemas Constructivos Modulares SIP</span>
            <h1 class="hero-title" style="font-size: 3rem;">Configura tu Nuevo Hogar</h1>
            <p style="max-width: 600px; margin: 20px auto; color: var(--text-secondary);">
                Elige entre nuestros modelos, selecciona el nivel de terminaci√≥n y obt√©n un valor estimado al instante.
            </p>
        </div>
    </header>

    <!-- Shipping Banner -->
    <div class="container">
        <div class="shipping-banner">
            <span>üöö</span>
            DESPACHO GRATIS: Regi√≥n Metropolitana y V Regi√≥n (hasta 100km a la redonda).
        </div>
    </div>

    <!-- CALCULATOR SECTION -->
    <section class="calculator-section" id="cotizador-anchor">
        <div class="container">

            <!-- 1. Model Selector (Expanded to 6) -->
            <div class="model-selector" id="model-list">
                <button class="model-btn active" onclick="selectModel('tiny', this)">Tiny 18m¬≤</button>
                <button class="model-btn" onclick="selectModel('m35', this)">Modelo 35m¬≤</button>
                <button class="model-btn" onclick="selectModel('m45', this)">Modelo 45m¬≤</button>
                <button class="model-btn" onclick="selectModel('m54', this)">Modelo 54m¬≤</button>
                <button class="model-btn" onclick="selectModel('m72', this)">Modelo 72m¬≤</button>
                <button class="model-btn" onclick="selectModel('m90', this)">Modelo 90m¬≤</button>
            </div>

            <div class="config-grid">
                <!-- Left: Options -->
                <div class="config-options">

                    <!-- Image Preview (Improved) -->
                    <div class="product-image-wrapper glass-card">
                        <img id="model-image" src="images/tiny18m2_unified.jpg" alt="Modelo Seleccionado">
                    </div>

                    <!-- 1. Construction Services (Only for Kit) -->
                    <div id="addons-section">
                        <h3 class="config-section-title">1. Servicios de Construcci√≥n (Opcional Kit)</h3>
                        <div style="display: grid; gap: 15px; margin-bottom: 25px;">
                            <label class="option-card">
                                <div class="option-header">
                                    <span>üî® Servicio de Armado</span>
                                    <input type="checkbox" id="check-armado" onchange="updatePrice()"
                                        style="accent-color: var(--primary-500); transform: scale(1.2);">
                                </div>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">Nosotros armamos la
                                    estructura en tu terreno.</p>
                            </label>

                            <label class="option-card">
                                <div class="option-header">
                                    <span>üß± Radier de Hormig√≥n</span>
                                    <input type="checkbox" id="check-radier" onchange="updatePrice()"
                                        style="accent-color: var(--primary-500); transform: scale(1.2);">
                                </div>
                                <p style="font-size: 0.85rem; color: var(--text-secondary);">Construcci√≥n de base s√≥lida
                                    de concreto.</p>
                            </label>
                        </div>
                    </div>

                    <!-- 2. Tier Selection -->
                    <div>
                        <h3 class="config-section-title">2. Nivel de Terminaci√≥n (Tier)</h3>
                        <div style="display: grid; gap: 15px;">
                            <label class="option-card selected" onclick="selectTier('kit', this)">
                                <div class="option-header">
                                    <span>üèóÔ∏è Kit Autoconstrucci√≥n (B√°sico)</span>
                                    <input type="radio" name="tier" value="kit" checked
                                        style="accent-color: var(--primary-500);">
                                </div>
                                <p style="font-size: 0.9rem; margin: 0; color: var(--text-secondary);">
                                    Solo materiales estructurales (Paneles SIP, maderas, fijaciones). Ideal para
                                    autoconstrucci√≥n.
                                </p>
                            </label>

                            <label class="option-card" onclick="selectTier('ogh', this)">
                                <div class="option-header">
                                    <span>üè† Obra Gruesa Habitable</span>
                                    <input type="radio" name="tier" value="ogh"
                                        style="accent-color: var(--primary-500);">
                                </div>
                                <p style="font-size: 0.9rem; margin: 0; color: var(--text-secondary);">
                                    Estructura armada, con ventanas termopanel, puertas, y conexiones b√°sicas (agua/luz)
                                    dentro de la casa. Sin terminaciones finas.
                                </p>
                            </label>

                            <label class="option-card" onclick="selectTier('lem', this)">
                                <div class="option-header">
                                    <span>üîë Llave en Mano (Full)</span>
                                    <input type="radio" name="tier" value="lem"
                                        style="accent-color: var(--primary-500);">
                                </div>
                                <p style="font-size: 0.9rem; margin: 0; color: var(--text-secondary);">
                                    Lista para habitar. Incluye terminaciones, pisos vin√≠licos, ba√±o equipado, cocina
                                    amoblada y closet.
                                </p>
                            </label>
                        </div>
                    </div>

                </div>

                <!-- Right: Summary Panel -->
                <div class="checkout-panel">
                    <h3 style="margin-bottom: 20px; color: var(--text-primary);">Resumen Cotizaci√≥n</h3>

                    <div class="price-row">
                        <span id="summary-model">Tiny 18m¬≤</span>
                        <span id="price-base">$3.990.000</span>
                    </div>

                    <div id="summary-addons">
                        <!-- Dynamic Addons -->
                    </div>

                    <div class="price-total">
                        <span>TOTAL ESTIMADO (+IVA)</span>
                        <span id="final-price">$3.990.000</span>
                    </div>

                    <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 10px; font-style: italic;">
                        * Precios netos. Agregar IVA (19%).
                    </p>

                    <button onclick="scrollToForm()" class="btn btn-primary btn-full" style="margin-top: 30px;">
                        Solicitar esta Configuraci√≥n
                    </button>

                    <div class="promo-box glass-card"
                        style="margin-top: 20px; padding: 15px; border: 1px dashed var(--primary-500);">
                        <span class="promo-title">üî• Promo Web</span>
                        <p style="margin:0; font-size: 0.9rem;">Incluye Cubierta de Zinc Gratis (Solo Kit).</p>
                    </div>
                </div>
            </div>

            <!-- Tech Specs -->
            <div class="tech-specs">
                <div class="spec-item">
                    <span class="spec-icon">üå°Ô∏è</span>
                    <strong>Aislaci√≥n T√©rmica</strong>
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">Panel SIP 114mm</p>
                </div>
                <div class="spec-item">
                    <span class="spec-icon">üèóÔ∏è</span>
                    <strong>Estructura</strong>
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">Madera Calibrada IPV</p>
                </div>
                <div class="spec-item">
                    <span class="spec-icon">üîä</span>
                    <strong>Ac√∫stica</strong>
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">Reducci√≥n de Ruido</p>
                </div>
                <div class="spec-item">
                    <span class="spec-icon">‚ö°</span>
                    <strong>R√°pido Montaje</strong>
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">Sistema Modular</p>
                </div>
            </div>

            <!-- Comparison Table -->
            <div class="comparison-wrapper glass-card" style="margin-top: 60px;">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th class="col-feature">Caracter√≠stica</th>
                            <th class="col-us">‚úÖ Sistema SIP Capi</th>
                            <th class="col-other">‚ùå Caba√±a Madera Com√∫n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Eficiencia T√©rmica</td>
                            <td><strong>Ahorro 60% Califacci√≥n</strong></td>
                            <td>P√©rdida de calor constante</td>
                        </tr>
                        <tr>
                            <td>Vida √ötil</td>
                            <td><strong>+50 A√±os (Eterno)</strong></td>
                            <td>10-15 A√±os (Se pudre)</td>
                        </tr>
                        <tr>
                            <td>Resistencia Fuego</td>
                            <td><strong>Retardante (Autoextinguible)</strong></td>
                            <td>Altamente Inflamable</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </section>

    <!-- Contact Form (Replaces WhatsApp Link) -->
    <section id="contacto-formal" class="contact" style="padding: 80px 0;">
        <div class="container" style="max-width: 650px;">
            <div class="contact-wrapper glass-card">
                <span class="label-upper" style="text-align: center; display: block;">Reserva tu Llamada</span>
                <h2 class="section-title" style="text-align: center;">Agendar Llamada</h2>
                <p style="text-align: center; margin-bottom: 25px; font-size: 0.95rem; color: var(--text-secondary);">
                    Recibe asesor√≠a personalizada sobre tu configuraci√≥n.
                </p>

                <form class="contact-form">
                    <input type="hidden" id="form-config" name="configuracion" value="">

                    <div class="form-group">
                        <label>Nombre Completo</label>
                        <input type="text" required>
                    </div>
                    <div class="form-group">
                        <label>Tel√©fono</label>
                        <input type="tel" required>
                    </div>
                    <div class="form-group">
                        <label>Regi√≥n de Instalaci√≥n</label>
                        <select class="form-control"
                            style="width: 100%; padding: 15px; border-radius: 8px; background: var(--input-bg); color: var(--text-primary); border: 1px solid var(--input-border);">
                            <option value="RM">Regi√≥n Metropolitana (Despacho Gratis)</option>
                            <option value="V">V Regi√≥n (Despacho Gratis)</option>
                            <option value="Otra">Otra Regi√≥n (Flete por pagar)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mensaje Adicional</label>
                        <textarea rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Enviar Solicitud</button>
                </form>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom" style="margin-top: 40px;">
                <p>&copy; 2026 Constructora Capi Zapallar.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="script.js"></script>

    <!-- Calculator Logic -->
    <script>
        const pricing = {
            tiny: { kit: 3990000, armado: 1690000, radier: 1100000, ogh: 12590000, lem: 16990000, m2: 18 },
            m35: { kit: 7990000, armado: 3150000, radier: 2100000, ogh: 22492500, lem: 29990000, m2: 35 },
            m45: { kit: 9990000, armado: 4050000, radier: 2700000, ogh: 28425000, lem: 37900000, m2: 45 },
            m54: { kit: 11990000, armado: 4860000, radier: 3240000, ogh: 32925000, lem: 43900000, m2: 54 },
            m72: { kit: 15490000, armado: 6480000, radier: 4320000, ogh: 41175000, lem: 54900000, m2: 72 },
            m90: { kit: 18990000, armado: 8100000, radier: 5400000, ogh: 52425000, lem: 69900000, m2: 90 }
        };

        let currentModel = 'tiny';
        const modelImage = document.getElementById('model-image');

        function selectModel(model, element) {
            currentModel = model;

            // UI Toggle for buttons
            document.querySelectorAll('.model-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');

            // Image Update Logic
            modelImage.src = `images/${model}_unified.jpg`;

            // Fallback for m18 legacy name
            if (model === 'tiny') {
                modelImage.onerror = function () {
                    this.src = 'images/tiny6x3.jpg';
                    this.onerror = null;
                };
            } else {
                modelImage.onerror = function () {
                    this.src = 'images/tiny6x3.jpg'; // Global fallback
                    this.onerror = null;
                    console.log("No se encontr√≥ la imagen: " + model);
                };
            }

            // Update Summary Name
            const names = {
                tiny: "Tiny 18m¬≤", m35: "Modelo 35m¬≤", m45: "Modelo 45m¬≤",
                m54: "Modelo 54m¬≤", m72: "Modelo 72m¬≤", m90: "Modelo 90m¬≤"
            };
            document.getElementById('summary-model').innerText = names[model];

            updatePrice();
        }

        function selectTier(tier, element) {
            // UI Toggle
            document.querySelectorAll('.option-card').forEach(card => card.classList.remove('selected'));
            element.classList.add('selected');

            // Check radio manually bc we clicked the label/div
            element.querySelector('input[type="radio"]').checked = true;

            // Show/Hide Addons
            const addons = document.getElementById('addons-section');
            if (tier === 'kit') {
                addons.style.display = 'block';
                addons.style.opacity = '1';
            } else {
                addons.style.display = 'none';
                // Uncheck addons to avoid confusion in price
                document.getElementById('check-armado').checked = false;
                document.getElementById('check-radier').checked = false;
            }

            updatePrice();
        }

        function formatMoney(amount) {
            return '$' + amount.toLocaleString('es-CL');
        }

        function updatePrice() {
            const tier = document.querySelector('input[name="tier"]:checked').value;
            let total = 0;
            let basePrice = 0;

            const summaryAddons = document.getElementById('summary-addons');
            summaryAddons.innerHTML = ''; // Clear previous

            // Base Tier Price
            if (tier === 'kit') basePrice = pricing[currentModel].kit;
            else if (tier === 'ogh') basePrice = pricing[currentModel].ogh;
            else if (tier === 'lem') basePrice = pricing[currentModel].lem;

            total += basePrice;
            document.getElementById('price-base').innerText = formatMoney(basePrice);

            // Addons (If Kit)
            if (tier === 'kit') {
                if (document.getElementById('check-armado').checked) {
                    const p = pricing[currentModel].armado;
                    total += p;
                    summaryAddons.innerHTML += `<div class="price-row"><span>+ Servicio Armado</span><span>${formatMoney(p)}</span></div>`;
                }
                if (document.getElementById('check-radier').checked) {
                    const p = pricing[currentModel].radier;
                    total += p;
                    summaryAddons.innerHTML += `<div class="price-row"><span>+ Radier Hormig√≥n</span><span>${formatMoney(p)}</span></div>`;
                }
            }

            document.getElementById('final-price').innerText = formatMoney(total);

            // Build config string for form
            let configStr = `Modelo: ${currentModel.toUpperCase()}, Nivel: ${tier.toUpperCase()}, Total Est: ${formatMoney(total)}`;
            document.getElementById('form-config').value = configStr;
        }

        function scrollToForm() {
            document.getElementById('contacto-formal').scrollIntoView({ behavior: 'smooth' });
        }

        // Init
        updatePrice();
    </script>
</body>

</html>